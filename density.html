<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>밀도 계산</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap');
        body {
            font-family: "Nanum Gothic Coding", monospace;
        }
        canvas {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <main>
        <h1>글자 밀도 계산기</h1>
        <section>
            <article>
                <label for="charInput">글자를 입력하세요 : </label>
                <input type="text" id="charInput" maxlength="1" placeholder="한 글자">
            </article>
            <button id="calculateBtn">밀도 계산하기</button>
        </section>

        <section>
            <canvas id="canvas" width="100" height="100"></canvas>
            <h1 id="resultText"></h1>
        </section>
    </main>

    <script>
        function getDensity(canvas, font, char) {
            if( !char ) {
                return 0;
            }

            const fontSize = font.size;
            const fontName = font.name;//"Nanum Gothic Coding";//"monospace";
            const character = char;
            
            // 캔버스 초기화 및 배경을 흰색으로 채우기
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 글자 스타일 설정 및 그리기
            ctx.font = `${fontSize}px "${fontName}"`;
            ctx.fillStyle = 'black';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'center';

            const x = canvas.width / 2;
            const y = canvas.height / 2;
            
            ctx.fillText(character, x, y);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            let blackPixelCount = 0;

            // 픽셀 데이터를 순회하며 검은색 픽셀 수 계산
            for (let i = 0; i < data.length; i += 4) {
                const red = data[i];
                const green = data[i + 1];
                const blue = data[i + 2];

                // 흑백 글자이므로 RGB 값이 모두 50 이하인 경우를 검은색으로 판단
                if (red < 50 && green < 50 && blue < 50) {
                    blackPixelCount++;
                }
            }
            
            const totalPixels = (canvas.width * canvas.height);
            const density = (blackPixelCount / totalPixels) * 100;

            return density;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            const charInput = document.getElementById('charInput');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultText = document.getElementById('resultText');

            charInput.addEventListener('keydown', e => {
                if( e.keyCode == 13 ) {
                    calculateBtn.click();
                }
            });

            calculateBtn.addEventListener('click', () => {
                let font = {
                    name: "Nanum Gothic Coding",//"monospace";
                    size: 80
                };
                let result = getDensity(canvas, font, charInput.value);

                resultText.textContent = `${result}%`;
            });

            let list = ['ㄱ', 'ㄴ', 'ㄷ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅅ', 'ㅇ', 'ㅈ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ', 'ㅏ', 'ㅑ', 'ㅓ', 'ㅕ', 'ㅗ', 'ㅛ', 'ㅜ', 'ㅠ', 'ㅡ', 'ㅣ', '.', '!', '?', ' '];
            let map = [];
            for( var i = 0; i < list.length; i++ ) {
                let font = {
                    name: "Nanum Gothic Coding",//"monospace";
                    size: 80
                };
                let result = getDensity(canvas, font, list[i]);
                console.log(list[i] + " = " + result);
                map.push({char: list[i], density: result});
            }

            map.sort((a, b) => b.density - a.density);
            var str = "";
            console.log(map.map(o => str += o.char));
            console.log(str);
        });
    </script>
</body>
</html>